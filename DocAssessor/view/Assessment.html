<html>
<head>
<!-- Bootstrap Style sheet  -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

<!-- Bootstrap JS file -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>




</head>
<body onload="fn_setusername()">
<style>
body {
  background: url('https://source.unsplash.com/twukN12EN7c/1920x1080') no-repeat center center fixed;
  -webkit-background-size: cover;
  -moz-background-size: cover;
  background-size: cover;
  -o-background-size: cover;
}
</style>
<!-- Navigation Bar -->
	<nav class="navbar navbar-expand-md navbar-dark bg-dark">
    <div class="navbar-collapse collapse justify-content-stretch" id="navbar">
        <ul class="navbar-nav">
            <li class="nav-item active">
                <a class="nav-link" href="home.html">Home <span class="sr-only">Home</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="My Tasks.html">My Tasks</a>
            </li>
			<li class="nav-item">
                <a class="nav-link" href="All_Tasks.html">View Task List</a>
            </li>
			<!---For testing scipt-->
			<!--button type="button" onclick="fn_getassessments()"> Display</button-->
			<!------------------------------------>
        </ul>
        <ul class="navbar-nav ml-auto">
		 <li>
		    <a class="navbar-brand" href="#"> <div id="uname"></div></a>
			</li>
			<li class="nav-item">
				
				  <a class="nav-link" href="#" onclick="fn_signout()">Sign Out</a>
				
			</li>
        </ul>
    </div>
</nav>
<!-- end navigation -->
<script> src="loginscript.js"</script>
<script>
function getCookie(cname) {
  var name = cname + "=";
  var decodedCookie = decodeURIComponent(document.cookie);
  var ca = decodedCookie.split(';');
  for(var i = 0; i <ca.length; i++) {
    var c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}
//Funtion to submit the assessment form
function fn_sendassessment(form)
{ 
             var userid = getCookie('userid'); 
			  var assessmentid = getCookie('assessmentid'); 
			   var resourceId = getCookie('resourceId'); 
			   
            // Creating a XMLHttpRequest object 
            var xmlhttp = new XMLHttpRequest(); 
            //var url = "http://localhost:4000/login"; 
            var url = "http://localhost:4000/user/"+userid+"/assessment/"+assessmentid+"/resource/"+resourceId;
            // open a connection 
			
            xmlhttp.open("POST", url, true); 
			           
			
            // Set the request header i.e. which type of content you are sending 
            xmlhttp.setRequestHeader("Content-Type", "application/json"); 
			
			       
            
  
            // Converting JSON data to string 
            var data = JSON.stringify({ "text": form.feedback.value, "rating": form.rating.value }); 
  
            // Sending data with the request 
            xmlhttp.send(data); 
			
			//xmlhttp.onload = () => window.location.href = "/home.html";//alert(JSON.stringify(xmlhttp.response));//alert(request);//window.location.href = "/home.html";
			
			xmlhttp.onload = function(){
			   //Get the token from the JSON response by parsing it.
			   //let token = JSON.stringify(xmlhttp.response);
			   let res = JSON.parse(xmlhttp.response);
			   
			   //alert("response after form submission"+res);
			   $('#successModal').modal('show')
			   }
			//alert("This is to test");
			event.preventDefault();
}
function fn_signout()
{
     //alert("Inside signout");
     if (getCookie('userid')!="")
		  {
		  //alert("Inside signout");
		    document.cookie = "userid =";
			document.cookie = "firstname =";
			window.location.href = "/index.html";
		  }

}
function fn_redirect(){
   window.location.href = "/Resources.html";

}
function fn_setusername()
{
     //alert(getCookie('firstname'));
	 document.getElementById('uname').innerHTML= 'Welcome ' +getCookie('firstname');
}
</script>
<!-- Main Layout -->
<div class="container">
	<div class="row mx-auto">
		<div class="col md-3  ">
		<br>
			
				<h2 style="text-align:center ">Provide assessment for the resource</h2>
				<div class= "card  border border-warning"></div>
				<div class="card-body border border-dark">
				   <form name="assessmentForm">
						  <div class="form-group">
						  <label for="Feedback">Feedback</label>
						  <input type="text" class="form-control" id="feedback" name="feedback" placeholder="Provide your feedback of summary of the resourse here">
						  </div>
						  <div class="form-group">
						  <label for="rating">Rating</label>
						  <input type="text" class="form-control" id="rating" name="rating" placeholder="Provide your rating for the resource here.">
						  </div>
							  
						
						  </div>
						  <div class="modal-footer">
							
							<button class="btn btn-primary" onclick="fn_sendassessment(this.form)">Submit</button>
						  </div>
					  </form>				
					
				</div>
			</div>
		</div>
		<div class="col"></div>
	</div>
	</div>
</div>
<!-- End Main Layout>-->

<!-- Success message--->
<!-- Button trigger modal -->
<!-- Modal -->
<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body">
         Assessment Succesfully Submitted
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="fn_redirect();">Ok</button>
      </div>
    </div>
  </div>
</div>

<!-- --->
</body>
</html>